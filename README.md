# 新聞爬蟲與股票趨勢分析

## 專案概述
此專案通過網絡爬蟲技術，抓取財經類網站（Yahoo財經、鉅亨網、MoneyDJ）的最新新聞，並基於這些數據分析股票未來趨勢。系統提供REST API接口，讓用戶可以方便地獲取各平台的新聞數據。分析結果會生成直觀的HTML報告，包含情感分析、趨勢預測和視覺化圖表。
在Cursor + claude3.7-sonnet協助下完成

## 功能特點
- 根據關鍵字或股票代號搜索相關新聞
- 使用Chrome瀏覽器模擬方式進行爬取
- 針對每個目標網站（Yahoo財經、鉅亨網、MoneyDJ）抓取24小時內的10條最新新聞
- 基於抓取的新聞數據進行情感分析和趨勢預測
- 生成包含餅圖的可視化HTML報告
- 自動在瀏覽器中打開報告（支持Windows、macOS和Linux）
- 提供REST API接口，便於其他應用程序調用
- 當無法獲取真實數據時，提供合理的示例數據（帶有標記）

## 安裝要求
- Python 3.8+
- Chrome瀏覽器
- 相關Python庫（詳見requirements.txt）

## 安裝步驟
1. 克隆專案到本地
   ```
   git clone [專案連結]
   cd [專案資料夾]
   ```

2. 安裝依賴庫
   ```
   pip install -r requirements.txt
   ```

3. 確保Chrome瀏覽器已安裝，並下載對應版本的ChromeDriver

## 使用方法
1. 運行主程序
   ```
   python main.py
   ```

2. 在界面中輸入關鍵字或股票代號

3. 系統將自動抓取相關新聞並分析趨勢

4. 分析完成後，系統會生成HTML報告並自動打開，並詢問是否查看分析報告

5. 若要直接使用API，可通過以下端點：
   ```
   GET /api/v2/news?keyword=台積電&source=all&limit=10
   ```

## API參數說明
- `keyword`: 關鍵字或股票代號
- `source`: 新聞來源（yahoo、cnyes、moneydj 或 all）
- `limit`: 每個來源返回的新聞數量（默認10）
- `hours`: 搜索多少小時內的新聞（默認24）

## 數據返回格式
```json
{
  "data": [
    {
      "title": "新聞標題",
      "link": "https://news.url",
      "published_time": "2023-12-01 14:30:00",
      "source": "Yahoo財經",
      "summary": "新聞摘要...",
      "platform": "Yahoo",
      "is_sample": false
    }
  ],
  "count": 1,
  "status": "success",
  "message": "成功獲取新聞"
}
```

## 分析報告
系統會自動生成HTML格式的分析報告，包含以下內容：
- 分析摘要（關鍵詞、情感分析結果、趨勢預測）
- 情感分布餅圖（直觀顯示積極、消極和中性新聞的比例）
- 新聞列表（包含標題、來源、日期和情感評級）

報告會根據亞洲金融市場慣例，使用以下顏色編碼：
- 紅色：代表積極情感或看漲趨勢
- 綠色：代表消極情感或看跌趨勢
- 灰色：代表中性情感或震盪趨勢

報告會自動保存在`data/reports/`目錄下，並在生成後自動在瀏覽器中打開。

## 關於示例數據
為了確保API的穩定性，當爬蟲無法從網站獲取真實新聞時（可能由於網站反爬機制或其他原因），系統會生成相關的示例新聞數據。這些示例數據會通過`is_sample`字段標記為`true`，以便API使用者能夠識別。示例數據具有以下特點：

- 標題和摘要內容與搜索關鍵字相關
- 日期時間為最近7天內的隨機時間
- 明確標記為示例數據（is_sample = true）

## 爬蟲模塊說明
系統包含三個主要爬蟲模塊：

1. **Yahoo財經爬蟲**：抓取Yahoo財經的新聞，並提取來源、日期等信息
2. **鉅亨網爬蟲**：抓取鉅亨網的財經新聞
3. **MoneyDJ爬蟲**：抓取MoneyDJ的台股相關新聞

每個爬蟲模塊都有獨立的錯誤處理機制，確保系統穩定運行。即使某些來源暫時不可用，系統仍然能夠提供可靠的數據。

## 數據分析方法
- 新聞文本情感分析（基於VADER和自定義中文詞庫）
- 關鍵詞提取與統計
- 歷史數據對比
- 趨勢預測算法

## 錯誤處理
系統針對各種可能的錯誤情況進行了處理：
- 網站無法訪問時的重試機制
- 反爬措施導致的數據獲取失敗處理
- 當所有嘗試都失敗時，提供示例數據確保API穩定性
- 處理報告打開失敗的備用方案

## 最近更新
- 改進Yahoo爬蟲，優化來源和時間提取邏輯
- 更新報告生成功能，添加餅圖展示情感分布
- 引入跨平台報告查看功能，支持Windows、macOS和Linux
- 優化HTML報告的顏色編碼，符合亞洲金融市場慣例
- 修正多個瀏覽器窗口同時打開的問題

## 待開發功能
- 更多數據視覺化展示
- 自定義時間範圍
- 更多財經網站支持
- 更豐富的導出分析報告選項
- 增強數據分析算法精確度

## 測試
可以使用以下命令運行測試：
```
python test_yahoo.py
python test_cnyes.py
python test_moneydj.py
```

## 貢獻指南
歡迎提交問題或建議，也歡迎提交Pull Request來改進專案。

## 授權
[授權信息]